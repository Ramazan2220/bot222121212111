# üöÄ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø PostgreSQL –î–õ–Ø VDSina PRO
# –°–µ—Ä–≤–µ—Ä: 8 CPU, 16GB RAM, 240GB SSD
# –ù–∞–≥—Ä—É–∑–∫–∞: 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, 50,000 –∞–∫–∫–∞—É–Ω—Ç–æ–≤

# =============================================================================
# –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ò –ü–ê–ú–Ø–¢–¨
# =============================================================================

# –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
max_connections = 500

# –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (25% –æ—Ç RAM = 4GB)
shared_buffers = 4GB

# –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ (75% –æ—Ç RAM = 12GB)
effective_cache_size = 12GB

# –ü–∞–º—è—Ç—å –¥–ª—è maintenance –æ–ø–µ—Ä–∞—Ü–∏–π
maintenance_work_mem = 1GB

# –ü–∞–º—è—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
work_mem = 32MB

# =============================================================================
# –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ó–ê–ü–ò–°–ò
# =============================================================================

# WAL –±—É—Ñ–µ—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏
wal_buffers = 64MB

# Checkpoint –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è SSD
checkpoint_completion_target = 0.9
max_wal_size = 4GB
min_wal_size = 1GB

# =============================================================================
# –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –î–õ–Ø SSD
# =============================================================================

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è SSD –¥–∏—Å–∫–æ–≤
random_page_cost = 1.1
seq_page_cost = 1.0

# –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
default_statistics_target = 100

# =============================================================================
# –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê
# =============================================================================

# –í–∫–ª—é—á–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (8 CPU)
max_worker_processes = 8
max_parallel_workers = 8
max_parallel_workers_per_gather = 4
max_parallel_maintenance_workers = 4

# =============================================================================
# –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì
# =============================================================================

# –õ–æ–≥–∏—Ä—É–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
log_min_duration_statement = 1000  # 1 —Å–µ–∫—É–Ω–¥–∞
log_line_prefix = '%t [%p]: user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on

# =============================================================================
# –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø INSTAGRAM –ë–û–¢–ê
# =============================================================================

# –ê–≤—Ç–æ–≤–∞–∫—É—É–º –¥–ª—è —á–∞—Å—Ç—ã—Ö INSERT/UPDATE
autovacuum = on
autovacuum_max_workers = 4
autovacuum_naptime = 30s

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞
track_activities = on
track_counts = on
track_io_timing = on

# =============================================================================
# –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
# =============================================================================

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
listen_addresses = '*'
port = 5432

# SSL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
ssl = on
ssl_cert_file = 'server.crt'
ssl_key_file = 'server.key'

# =============================================================================
# –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò
# =============================================================================

# –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
huge_pages = try

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JIT –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
jit = on
jit_above_cost = 100000

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
tcp_keepalives_idle = 600
tcp_keepalives_interval = 30
tcp_keepalives_count = 3 